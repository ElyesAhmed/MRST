
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>surfaceSystemTransport</title><meta name="generator" content="MATLAB 8.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-12-05"><meta name="DC.source" content="surfaceSystemTransport.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Define the grid</a></li><li><a href="#3">Define the rock</a></li><li><a href="#4">Define the fluid</a></li><li><a href="#5">Define the chemistry</a></li><li><a href="#6">solve for the initial state</a></li><li><a href="#7">Define the transport model</a></li><li><a href="#8">Define the boundary conditions</a></li><li><a href="#9">Define the schedule</a></li><li><a href="#10">Run the simulation</a></li><li><a href="#11">visualize the simulation</a></li><li><a href="#12">Copyright notice</a></li></ul></div><pre class="codeinput">close <span class="string">all</span>;
clear;

mrstModule <span class="string">add</span> <span class="string">ad-core</span> <span class="string">ad-props</span> <span class="string">ad-blackoil</span> <span class="string">geochemistry</span>

mrstVerbose <span class="string">off</span>
</pre><h2>Define the grid<a name="2"></a></h2><p>here we define a 1D domain with 10 cells, each a meter in length</p><pre class="codeinput">G = cartGrid([10, 1, 1], [10, 1, 1]);
G = computeGeometry(G);
nc = G.cells.num;
</pre><h2>Define the rock<a name="3"></a></h2><pre class="codeinput">rock.perm = 1*darcy*ones(G.cells.num, 1);
rock.poro = ones(G.cells.num, 1);
</pre><h2>Define the fluid<a name="4"></a></h2><pre class="codeinput">pRef = 0*barsa;
fluid = initSimpleADIFluid(<span class="string">'phases'</span>, <span class="string">'W'</span>, <span class="string">'mu'</span>, 1*centi*poise, <span class="string">'rho'</span>, <span class="keyword">...</span>
                           1000*kilogram/meter^3, <span class="string">'c'</span>, 1e-10, <span class="string">'cR'</span>, 4e-10, <span class="keyword">...</span>
                           <span class="string">'pRef'</span>, pRef);
</pre><h2>Define the chemistry<a name="5"></a></h2><p>the chemical system include the speciation of NaCl and H2O, as well as a reactive silica surface which can have a negative or neutral surface</p><pre class="codeinput">elements = {<span class="string">'O'</span>, <span class="string">'H'</span>, <span class="string">'Na*'</span>,<span class="string">'Cl*'</span>};

species = {<span class="string">'H+*'</span>, <span class="string">'OH-'</span>, <span class="string">'Na+'</span>, <span class="string">'H2O*'</span>, <span class="string">'&gt;SiO-'</span>, <span class="string">'&gt;SiOH'</span>, <span class="string">'NaCl'</span>,<span class="string">'Cl-'</span>};

reactions ={<span class="string">'H2O  = H+  + OH- '</span>,      10^-14*mol/litre, <span class="keyword">...</span>
            <span class="string">'NaCl = Na+ + Cl-'</span>,       10^1*mol/litre,<span class="keyword">...</span>
            <span class="string">'&gt;SiOH = &gt;SiO- + H+'</span>,     10^-8*mol/litre};

geometry = [2*site/(nano*meter)^2 50e-3*meter^2/(gram) 5e3*gram/litre];
sioInfo = {geometry, <span class="string">'tlm'</span>, [1 1e3], <span class="string">'&gt;SiO-'</span>, [-1 0 0], <span class="string">'&gt;SiOH'</span>, [0 0 0]};

surfaces = {<span class="string">'&gt;SiO'</span>, sioInfo};

<span class="comment">% instantiate chemical model object</span>
chemModel = ChemicalModel(elements, species, reactions, <span class="string">'surf'</span>, surfaces);

<span class="comment">% print the chemical model to the screen</span>
chemModel.printChemicalSystem;
</pre><pre class="codeoutput">
================================================================================================================================================================
|Equations      |          H+|         OH-|         Na+|         H2O|       &gt;SiO-|       &gt;SiOH|        NaCl|         Cl-| &gt;SiO_ePsi_0| &gt;SiO_ePsi_1| &gt;SiO_ePsi_2|
================================================================================================================================================================
|sum(O)         |           0|           1|           0|           1|           0|           0|           0|           0|           0|           0|           0|
|sum(H)         |           1|           1|           0|           2|           0|           1|           0|           0|           0|           0|           0|
|sum(Na)        |           0|           0|           1|           0|           0|           0|           1|           0|           0|           0|           0|
|sum(Cl)        |           0|           0|           0|           0|           0|           0|           1|           1|           0|           0|           0|
|sum(&gt;SiO)      |           0|           0|           0|           0|           1|           1|           0|           0|           0|           0|           0|
================================================================================================================================================================
|H2O=H++OH-     |           1|           1|           0|          -1|           0|           0|           0|           0|           0|           0|           0|
|NaCl=Na++Cl-   |           0|           0|           1|           0|           0|           0|          -1|           1|           0|           0|           0|
|&gt;SiOH=&gt;SiO-+H+ |           1|           0|           0|           0|           1|          -1|           0|           0|          -1|           0|           0|
================================================================================================================================================================

</pre><h2>solve for the initial state<a name="6"></a></h2><p>the column is originally saturated with a basic solution, an acidic solution is injected on the left boundary</p><pre class="codeinput"><span class="comment">% initial chemistry</span>
Nai = 1e-3;
Cli = Nai;
Hi = 1e-9;
H2Oi = 1;

inputConstraints = [Nai Cli Hi H2Oi]*mol/litre;
[initchemstate, initreport]= chemModel.initState(repmat(inputConstraints, nc,1), <span class="string">'charge'</span>, <span class="string">'Cl'</span>);

initState = initchemstate;
initState.pressure = pRef*ones(nc,1);

<span class="comment">% injected chemistry</span>
Naf = 1e-1;
Clf = Nai;
Hf = 1e-9;
H2Of = 1;

inputConstraints = [Naf Clf Hf H2Of]*mol/litre;
[injchemstate, injreport] = chemModel.initState(inputConstraints, <span class="string">'charge'</span>, <span class="string">'Cl'</span>);
</pre><pre class="codeoutput">Computing initial guess...
Solving chemical system...
Solving the chemical system with strict charge balance...
System is charge balanced to tolerance of 5.000000%...
Computing initial guess...
Solving chemical system...
Solving the chemical system with strict charge balance...
Warning: Charge balance not acheived with given inputs, abandoning solution from
attempt. Try a different element for charge compensation, or increase salt
content. 
</pre><h2>Define the transport model<a name="7"></a></h2><pre class="codeinput">model = ChemicalTransportModel(G, rock, fluid, chemModel);
</pre><h2>Define the boundary conditions<a name="8"></a></h2><p>here we specify a dirchlet boundary condition for pressure on the right hand side, and a constant flux on the left. The total element concentration at the boundaries must be provided.</p><pre class="codeinput"><span class="comment">% use model.fluidMat to pull the fluid concentrations from the injected</span>
<span class="comment">% state</span>
injfluidpart = injchemstate.species*model.fluidMat';
initfluidpart = initchemstate.species(end,:)*model.fluidMat';

pv = poreVolume(G,rock);

<span class="comment">% define source term at cell 1 for inflow boundary condition</span>
src                	= [];
src               	= addSource(src, 1, pv(1)/day, <span class="string">'sat'</span>, 1);

<span class="comment">% give the fluid concentration at the inlet</span>
src.elements        = injfluidpart;
src.logElements   	= log(injfluidpart);

<span class="comment">% give dirchlet boundary condition at outlet</span>
bc                  = [];
bc                  = pside(bc, G, <span class="string">'east'</span>, 0*barsa, <span class="string">'sat'</span>, 1);
bc.elements         = initfluidpart;        <span class="comment">% (will not be used if outflow)</span>
bc.logElements      = log(initfluidpart);  <span class="comment">% (will not be used if outflow)</span>
</pre><h2>Define the schedule<a name="9"></a></h2><p>it is recommened to ramp up the time stepping</p><pre class="codeinput"><span class="comment">% ten time steps of 0.01 days followed by 100 steps of 1 day</span>
schedule.step.val = [0.01*day*ones(10, 1); 1*day*ones(10, 1);];
schedule.step.control = ones(numel(schedule.step.val), 1);
schedule.control = struct(<span class="string">'bc'</span>, bc, <span class="string">'src'</span>, src, <span class="string">'W'</span>, []);
</pre><h2>Run the simulation<a name="10"></a></h2><pre class="codeinput">[~, states, scheduleReport] = simulateScheduleAD(initState, model, schedule);
</pre><pre class="codeoutput">Solving timestep 01/20:                                   -&gt; 864 Seconds
Solving timestep 02/20: 864 Seconds                       -&gt; 1728 Seconds
Solving timestep 03/20: 1728 Seconds                      -&gt; 2592 Seconds
Solving timestep 04/20: 2592 Seconds                      -&gt; 3456 Seconds
Solving timestep 05/20: 3456 Seconds                      -&gt; 1 Hour, 720 Seconds
Solving timestep 06/20: 1 Hour, 720 Seconds               -&gt; 1 Hour, 1584 Seconds
Solving timestep 07/20: 1 Hour, 1584 Seconds              -&gt; 1 Hour, 2448 Seconds
Solving timestep 08/20: 1 Hour, 2448 Seconds              -&gt; 1 Hour, 3312 Seconds
Solving timestep 09/20: 1 Hour, 3312 Seconds              -&gt; 2 Hours, 576 Seconds
Solving timestep 10/20: 2 Hours, 576 Seconds              -&gt; 2 Hours, 1440 Seconds
Solving timestep 11/20: 2 Hours, 1440 Seconds             -&gt; 1 Day, 2 Hours, 1440.00 Seconds
Solving timestep 12/20: 1 Day, 2 Hours, 1440.00 Seconds   -&gt; 2 Days, 2 Hours, 1440.00 Seconds
Solving timestep 13/20: 2 Days, 2 Hours, 1440.00 Seconds  -&gt; 3 Days, 2 Hours, 1440.00 Seconds
Solving timestep 14/20: 3 Days, 2 Hours, 1440.00 Seconds  -&gt; 4 Days, 2 Hours, 1440.00 Seconds
Solving timestep 15/20: 4 Days, 2 Hours, 1440.00 Seconds  -&gt; 5 Days, 2 Hours, 1440.00 Seconds
Solving timestep 16/20: 5 Days, 2 Hours, 1440.00 Seconds  -&gt; 6 Days, 2 Hours, 1440.00 Seconds
Solving timestep 17/20: 6 Days, 2 Hours, 1440.00 Seconds  -&gt; 7 Days, 2 Hours, 1440.00 Seconds
Solving timestep 18/20: 7 Days, 2 Hours, 1440.00 Seconds  -&gt; 8 Days, 2 Hours, 1440.00 Seconds
Solving timestep 19/20: 8 Days, 2 Hours, 1440.00 Seconds  -&gt; 9 Days, 2 Hours, 1440.00 Seconds
Solving timestep 20/20: 9 Days, 2 Hours, 1440.00 Seconds  -&gt; 10 Days, 2 Hours, 1440.00 Seconds
*** Simulation complete. Solved 20 control steps in 14 Seconds, 751 Milliseconds ***
</pre><h2>visualize the simulation<a name="11"></a></h2><pre class="codeinput">plotToolbar(G, states, <span class="string">'field'</span>, <span class="string">'species:1'</span>,<span class="string">'startplayback'</span>, true,<span class="string">'plot1D'</span>, true)
</pre><img vspace="5" hspace="5" src="surfaceSystemTransport_01.png" alt=""> <h2>Copyright notice<a name="12"></a></h2><p>
<p><font size="-1">
Copyright 2009-2017 SINTEF ICT, Applied Mathematics.
</font></p>
<p><font size="-1">
This file is part of The MATLAB Reservoir Simulation Toolbox (MRST).
</font></p>
<p><font size="-1">
MRST is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
</font></p>
<p><font size="-1">
MRST is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
</font></p>
<p><font size="-1">
You should have received a copy of the GNU General Public License
along with MRST.  If not, see
<a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses</a>.
</font></p>
</p><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2013b</a><br></p></div><!--
##### SOURCE BEGIN #####
close all;
clear;

mrstModule add ad-core ad-props ad-blackoil geochemistry

mrstVerbose off

%% Define the grid
% here we define a 1D domain with 10 cells, each a meter in length

G = cartGrid([10, 1, 1], [10, 1, 1]);
G = computeGeometry(G);
nc = G.cells.num;

%% Define the rock

rock.perm = 1*darcy*ones(G.cells.num, 1);
rock.poro = ones(G.cells.num, 1);

%% Define the fluid
pRef = 0*barsa;
fluid = initSimpleADIFluid('phases', 'W', 'mu', 1*centi*poise, 'rho', ...
                           1000*kilogram/meter^3, 'c', 1e-10, 'cR', 4e-10, ...
                           'pRef', pRef);

%% Define the chemistry
% the chemical system include the speciation of NaCl and H2O, as well as a
% reactive silica surface which can have a negative or neutral surface

elements = {'O', 'H', 'Na*','Cl*'};

species = {'H+*', 'OH-', 'Na+', 'H2O*', '>SiO-', '>SiOH', 'NaCl','Cl-'};

reactions ={'H2O  = H+  + OH- ',      10^-14*mol/litre, ... 
            'NaCl = Na+ + Cl-',       10^1*mol/litre,...
            '>SiOH = >SiO- + H+',     10^-8*mol/litre};

geometry = [2*site/(nano*meter)^2 50e-3*meter^2/(gram) 5e3*gram/litre];
sioInfo = {geometry, 'tlm', [1 1e3], '>SiO-', [-1 0 0], '>SiOH', [0 0 0]};

surfaces = {'>SiO', sioInfo};

% instantiate chemical model object
chemModel = ChemicalModel(elements, species, reactions, 'surf', surfaces);

% print the chemical model to the screen
chemModel.printChemicalSystem;

%% solve for the initial state
% the column is originally saturated with a basic solution, an acidic
% solution is injected on the left boundary

% initial chemistry
Nai = 1e-3;
Cli = Nai;
Hi = 1e-9;
H2Oi = 1;

inputConstraints = [Nai Cli Hi H2Oi]*mol/litre;
[initchemstate, initreport]= chemModel.initState(repmat(inputConstraints, nc,1), 'charge', 'Cl');

initState = initchemstate;
initState.pressure = pRef*ones(nc,1);

% injected chemistry
Naf = 1e-1;
Clf = Nai;
Hf = 1e-9;
H2Of = 1;

inputConstraints = [Naf Clf Hf H2Of]*mol/litre;
[injchemstate, injreport] = chemModel.initState(inputConstraints, 'charge', 'Cl');

%% Define the transport model
model = ChemicalTransportModel(G, rock, fluid, chemModel);

%% Define the boundary conditions
% here we specify a dirchlet boundary condition for pressure on the right
% hand side, and a constant flux on the left. The total element
% concentration at the boundaries must be provided.

% use model.fluidMat to pull the fluid concentrations from the injected
% state
injfluidpart = injchemstate.species*model.fluidMat';
initfluidpart = initchemstate.species(end,:)*model.fluidMat';

pv = poreVolume(G,rock);

% define source term at cell 1 for inflow boundary condition
src                	= [];
src               	= addSource(src, 1, pv(1)/day, 'sat', 1);

% give the fluid concentration at the inlet
src.elements        = injfluidpart;
src.logElements   	= log(injfluidpart);

% give dirchlet boundary condition at outlet
bc                  = [];
bc                  = pside(bc, G, 'east', 0*barsa, 'sat', 1);
bc.elements         = initfluidpart;        % (will not be used if outflow)
bc.logElements      = log(initfluidpart);  % (will not be used if outflow)


%% Define the schedule
% it is recommened to ramp up the time stepping

% ten time steps of 0.01 days followed by 100 steps of 1 day
schedule.step.val = [0.01*day*ones(10, 1); 1*day*ones(10, 1);];
schedule.step.control = ones(numel(schedule.step.val), 1);
schedule.control = struct('bc', bc, 'src', src, 'W', []);


%% Run the simulation

[~, states, scheduleReport] = simulateScheduleAD(initState, model, schedule);

%% visualize the simulation
plotToolbar(G, states, 'field', 'species:1','startplayback', true,'plot1D', true)

%% Copyright notice
%
% <html>
% <p><font size="-1">
% Copyright 2009-2017 SINTEF ICT, Applied Mathematics.
% </font></p>
% <p><font size="-1">
% This file is part of The MATLAB Reservoir Simulation Toolbox (MRST).
% </font></p>
% <p><font size="-1">
% MRST is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
% </font></p>
% <p><font size="-1">
% MRST is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
% </font></p>
% <p><font size="-1">
% You should have received a copy of the GNU General Public License
% along with MRST.  If not, see
% <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses</a>.
% </font></p>
% </html>


##### SOURCE END #####
--></body></html>